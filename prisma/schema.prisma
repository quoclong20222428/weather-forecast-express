datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id           String             @id @default(uuid())
  username     String
  email        String             @unique
  avatar       String?            // URL ảnh đại diện từ OAuth provider
  provider     String             // "google" | "facebook" | "github"
  providerId   String             @map("provider_id") // ID từ OAuth provider
  createdAt    DateTime           @default(now()) @map("created_at")

  savedCities  UserCity[]

  @@unique([provider, providerId])
  @@map("users")
}

model City {
  id           Int      @id @default(autoincrement())
  name         String
  lat          Float
  lon          Float
  
  savedByUsers UserCity[]
}

model UserCity {
  userId       String
  cityId       Int
  savedAt      DateTime @default(now()) @map("saved_at")
  
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  city         City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  
  @@id([userId, cityId])
  @@map("user_cities")
}

model Location {
  id           Int                      @id @default(autoincrement())
  display_name String                   @db.Text
  country      String?                  @db.Char(2)
  lat          Float                    @db.DoublePrecision // Vĩ độ (latitude) -90 đến 90
  lon          Float                    @db.DoublePrecision // Kinh độ (longitude) -180 đến 180
  search_vector Unsupported("tsvector")? // PostgreSQL full-text search vector

  @@index([display_name], map: "idx_display_name_prefix") // Fallback cho prefix search
  @@index([search_vector], type: Gin, map: "idx_search_vector_gin") // GIN index cho full-text search (RẤT NHANH với 2M+ records)
}
